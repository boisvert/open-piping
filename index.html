<!doctype html>
<meta charset="utf-8" />

<head>

<!--script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script-->
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script-->
<script src="../libraries/jquery.min.js"></script>
<script src="../libraries/jquery-ui.min.js"></script>

<!-- jsPlumb version: the code is incompatible version versions 2.2.x - endPoints not showing -->
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.1.8/jsPlumb.min.js"></script-->
<script src="../libraries/jsPlumb.2.1.8.min.js"></script>

<script src="workflow editor.js"></script>
<script src="compile_workflow.js"></script>
    
    <title>Edit and interpret a workflow</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
	
<style>

    #createNewBlock {
        position: absolute;
		right: 10px; top: 10px;
    }

    #pipeContainer {
        position: relative;
        padding: 20px;
        width:90%; height: 500px;
        border: 1px solid gray;
        display: flex;
        flex-direction: column;
    }

    .block {
        position: absolute;
        min-height:50px; min-width: 80px;
        border: 1px solid blue;
        flex: 1;
		font-family: Calibri, Arial, "Sans serif";
		font-size: 16px;
	    font-weight: bold;
	    padding-top: 5px; padding-left: 5px
    }

    .blockType {
        position: absolute;
        height:45px; width: 80px;
        border: 1px solid red;
		font-family: Calibri, Arial, "Sans serif";
		font-size: 16px;
	}

    .block:hover {
        border: 2px solid blue;
    }
    .blockType:hover{
        border: 2px solid blue;
    }
    .selectedBlock{
        border: 2px solid blue;
    }
	
	.editBlock {
	    position: absolute;
		right: 10px; top: 35px;
	    border: 2px solid black;
		height: 400px; width: 300px;
	}

	.jtk-endpoint {
	    z-index: 3000 !important;
    }
	
</style>

</head>

<body>

<h1>Open piping: lowering the barriers to data science</h1>

<h2>Interpret a symbolic expression into a function call and function set</h2>
Github project
  <a href="https://github.com/boisvert/open-piping">code</a> |
  <a href="https://github.com/boisvert/open-piping/wiki">wiki</a> | 
  <a href="https://github.com/boisvert/open-piping/issues">issues</a>
<p>

<div id="pipeContainer">
<button id="createNewBlock" onClick="editBlock();">Create new block</button>

</div>

You can compose an expression by using the blocks above, or try one of the ready-made ones below:<br />
<form>
<input type="button" value="simple list" onClick="inject(0);" />
<input type="button" value="booleans" onClick="inject(1);" />
<input type="button" value="function call" onClick="inject(2);" />
<input type="button" value="defun" onClick="inject(3);" /> 
<input type="button" value="defun recursive (fatorial)" onClick="inject(4);" />
<input type="button" value="defun higher order function (map)" onClick="inject(5);" />
<input type="button" value="numeric" onClick="inject(6);" /> 
<br />
<textarea id="s-exp" cols="80" rows="10"></textarea>
<br />
Language:
<select id="chooseLang">
<option value="JS" selected>JS</option>
<option value="PHP">PHP</option>
</select>
   <input type="button" value="Get code" onClick="getCode($('#chooseLang').val());" />
<br />
<textarea id="result" cols="80" rows="10">
</textarea>
<input type="button" value="Show result" onClick="runres();" /> <br />

</form>

<script>

// show sample of code
function inject(num) {
   var samples = [
      '[1, 2, 3, "a", "b", "c"]',
      '["or",["isNumber", 3], ["isNumber", "a"]]',
      '["plus", 1, 2]',
      '[\n  ["defun", "square", ["x"], ["times", "x", "x"]],\n  ["square", 2]\n]',
      '[\n  ["defun", "fac", ["n"], ["if", ["lt", "n", 2], 1, ["times", "n", ["fac", ["minus", "n", 1]] ]]],\n  ["fac", 10]\n]',
      '[\n  ["defun", "map", ["f", "arr"], ["if", ["isEmpty", "arr"], [], ["cons", ["apply", "f", [["first", "arr"]] ], ["map", "f", ["rest", "arr"] ] ] ]\n],\n["map", "\\\\isNumber", [1,2,3,"a","b","c"] ] ]',
      '1'
   ];
   document.getElementById('s-exp').value=samples[num];
}

// compile event
function getCode(lang) {
    if(lang==='JS') {
        var Exp = JSON.parse(document.getElementById('s-exp').value);
        $('#result').val(compile(Exp));
    }
    else if(lang==='PHP') {
        var Exp = encodeURIComponent(document.getElementById('s-exp').value);
        url = 'compile_workflow.php';
        $.post(url, 'exp='+Exp)
         .done(function( data ) {
            $('#result').val(data);
        });
    }
}

// run result
function runres() {
   var c = $('#result').val();
   alert(eval(c));
}

</script>
</body>
</html>
